# Виджет банковских операций клиента
   
## Описание:
IT-отдел крупного банка делает новую фичу для личного кабинета клиента. Это виджет, который показывает несколько последних успешных банковских операций клиента.

# Установка:

1. Клонируйте репозиторий:

-*ссылка на клонирование через токен:*
```HTTPS
git clone https://github.com/mossssolma-ui/homework_10_1.git
```
-*ссылка на клонирование через ssh:*
```SSH
git clone git@github.com:mossssolma-ui/homework_10_1.git
```
2. Установите зависимости:
```
poetry install
```
3. Реализованные функции:

*В модуле masks.py:*
+ Функция маскировки номера банковской карты: 
`get_mask_card_number`
+ Функция маскировки номера банковского счета: 
`get_mask_account`

*В модуле widget.py:*
+ Функция обработки информации как о картах, так и о счетах.
`mask_account_card`

*В модуле processing.py:*
+ Функция возвращает новый список словарей, содержащий только те словари, у которых ключ 
state соответствует указанному значению.
`filter_by_state`

*В модуле generators.py:*
+ Функция возвращает итератор, который поочередно выдает транзакции, где валюта операции соответствует заданной (например, USD).
`filter_by_currency`
+ Функция-генератор принимает список словарей с транзакциями и возвращает описание каждой операции по очереди. 
`transaction_descriptions`
+ Функция-генератор может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001 до 9999 9999 9999 9999. 
Генератор должен принимать начальное и конечное значения для генерации диапазона номеров.
`card_number_generator`

*В модуле decorators.py:*
+ Реализован декоратор`log`, который будет автоматически логировать начало и конец выполнения функции, а также ее результаты или возникшие ошибки.
Декоратор принимает необязательный аргумент `filename`, который определяет, куда будут записываться логи (в файл или в консоль).

*В модуле utils.py:*
+ Реализована функция `load_financial_transactions`, которая принимает на вход путь до JSON-файла и возвращает список словарей с данными о финансовых транзакциях. 
+ Реализована функция `get_transaction_amount`, которая принимает на вход транзакцию и возвращает сумму транзакции (amount) в рублях.

*В модуле external_api.py:*
+ Реализована функция `convert_to_rub`, которая принимает сумму транзакции и валюту (USD, EUR) и обращается к внешнему API для получения текущего курса валют и конвертации суммы операции в рубли.

*В модуле csv_excel.py:*
+ Реализована функция `get_convert_csv_to_list_dict`, конвертирует CSV → список словарей
+ Реализована функция `get_convert_excel_to_list_dict`, конвертирует Excel → список словарей

5. Примеры использования:

+ Функция `get_mask_card_number` принимает на вход номер карты и возвращает ее маску. Номер карты замаскирован и отображается в формате 
`XXXX XX** **** XXXX`, где `X` — это цифра номера. То есть видны первые 6 цифр и последние 4 цифры, остальные символы отображаются звездочками, номер разбит по блокам по 4 цифры, разделенным пробелами. Пример работы функции:
+ + + `7000792289606361     # входной аргумент`
+ + + `7000 79** **** 6361  # выход функции`.


+ Функция `get_mask_account` принимает на вход номер счета и возвращает его маску. Номер счета замаскирован и отображается в формате 
`**XXXX`, где `X` — это цифра номера. То есть видны только последние 4 цифры номера, а перед ними — две звездочки. Пример работы функции:
+ + + `73654108430135874305  # входной аргумент`
+ + + `**4305  # выход функции`.


+ Функция `mask_account_card` принимает один аргумент — строку, содержащую тип и номер карты или счета. И возвращает строку с замаскированным номером.
+ + Пример для карты:
+ + + `Visa Platinum 7000792289606361  # входной аргумент`
+ + + `Visa Platinum 7000 79** **** 6361  # выход функции`
+ + Пример для счета:
+ + + `Счет 73654108430135874305  # входной аргумент`
+ + + `Счет **4305  # выход функции`


+ Функция `filter_by_state` принимает список словарей и опционально значение для ключа 
`state` (по умолчанию `'EXECUTED'`). Функция возвращает новый список словарей, содержащий только те словари, у которых ключ 
`state` соответствует указанному значению. 
+ + Пример выходных данных:
+ + + Выход функции со статусом по умолчанию `'EXECUTED'`
`[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]`

+ + + Выход функции, если вторым аргументов передано `'CANCELED'`
`[{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}]`


+ Функция `filter_by_currency` принимает на вход список словарей, представляющих транзакции.
Функция должна возвращать итератор, который поочередно выдает транзакции, где валюта операции соответствует заданной (например, USD).
```usd_transactions = filter_by_currency(transactions, "USD")
for _ in range(2):
    print(next(usd_transactions))

>>> {
          "id": 939719570,
          "state": "EXECUTED",
          "date": "2018-06-30T02:08:58.425572",
          "operationAmount": {
              "amount": "9824.07",
              "currency": {
                  "name": "USD",
                  "code": "USD"
              }
          },
          "description": "Перевод организации",
          "from": "Счет 75106830613657916952",
          "to": "Счет 11776614605963066702"
      }
      {
              "id": 142264268,
              "state": "EXECUTED",
              "date": "2019-04-04T23:20:05.206878",
              "operationAmount": {
                  "amount": "79114.93",
                  "currency": {
                      "name": "USD",
                      "code": "USD"
                  }
              },
              "description": "Перевод со счета на счет",
              "from": "Счет 19708645243227258542",
              "to": "Счет 75651667383060284188"
       }
```
+ Функция-генератор `transaction_descriptions` принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.
```
descriptions = transaction_descriptions(transactions)
for _ in range(5):
    print(next(descriptions))

>>> Перевод организации
    Перевод со счета на счет
    Перевод со счета на счет
    Перевод с карты на карту
    Перевод организации
```
+ Функция-генератор `card_number_generator` который выдает номера банковских карт в формате 
`XXXX XXXX XXXX XXXX `, где `X`— цифра номера карты. Генератор может сгенерировать номера карт в заданном диапазоне от `0000 0000 0000 0001` до `9999 9999 9999 9999`.
Генератор должен принимать начальное и конечное значения для генерации диапазона номеров. 
```
for card_number in card_number_generator(1, 5):
    print(card_number)

>>> 0000 0000 0000 0001
    0000 0000 0000 0002
    0000 0000 0000 0003
    0000 0000 0000 0004
    0000 0000 0000 0005
```
+ Работа с CSV и Excel
```
from src.csv_excel import get_convert_csv_to_list_dict, get_convert_excel_to_list_dict

# Чтение CSV
csv_data = get_convert_csv_to_list_dict("data/transactions.csv")
print(csv_data[0])  # Первый словарь

# Чтение Excel
excel_data = get_convert_excel_to_list_dict("data/transactions.xlsx")
print(len(excel_data))  # Количество транзакций
```


+ Декоратор `log`, который автоматически логирует начало и конец выполнения функции, а также ее результаты или возникшие ошибки.
Декоратор принимает необязательный аргумент `filename`, который определяет, куда будут записываться логи (в файл или в консоль):
+ + Если `filename` задан, логи записываются в указанный файл.
+ + Если `filename` не задан, логи выводятся в консоль.

Логирование включает:
+ + Имя функции и результат выполнения при успешной операции.
+ + Имя функции, тип возникшей ошибки и входные параметры, если выполнение функции привело к ошибке.
```
@log(filename="mylog.txt")
def my_function(x, y):
    return x + y

my_function(1, 2)
```
Ожидаемый вывод в лог-файл `mylog.txt` при успешном выполнении:
```
Функция my_function выполнилась. 
Время работы функции:
старт: 1760554711.3145611
окончание: 1760554711.3145611
Время работы: 0.000
Результат: 3
```
Ожидаемый вывод при ошибке:
```
Функция my_function error: тип ошибки. Входные данные args: (1, 2), kwargs: {}
```
Где `тип ошибки` заменяется на текст ошибки.

6. Тестирование:
#### Для запуска тестов используйте команду:
```
pytest
```
#### Для запуска тестов с генерацией HTML-отчета о покрытии кода:
```
poetry run pytest --cov=src --cov-report html
```
текущее покрытие кода:
```
Name                         Stmts   Miss  Cover
------------------------------------------------
src\__init__.py                  0      0   100%
src\csv_excel.py                20      0   100%
src\decorators.py               23      0   100%
src\external_api.py             23      0   100%
src\generators.py               15      0   100%
src\masks.py                    38      3    92%
src\processing.py                6      0   100%
src\utils.py                    59      5    92%
src\widget.py                   25      0   100%
tests\__init__.py                0      0   100%
tests\conftest.py               19      0   100%
tests\test_csv_excel.py         29      0   100%
tests\test_decorators.py        41      0   100%
tests\test_external_api.py      35      0   100%
tests\test_generators.py        19      0   100%
tests\test_masks.py             17      0   100%
tests\test_processing.py         8      0   100%
tests\test_utils.py             58      0   100%
tests\test_widget.py            23      0   100%
------------------------------------------------
TOTAL                          458      8    98%
```
#### Для просмотра HTML-отчета введите в консоли:
```
start htmlcov/index.html
```

6. Документация и ссылки:
+ [SKYPRO 1](https://my.sky.pro/student-cabinet/stream-lesson/182802/homework-requirements)
+ [SKYPRO 2](https://my.sky.pro/student-cabinet/stream-lesson/182803/homework-requirements)
+ [SKYPRO 3](https://my.sky.pro/student-cabinet/stream-lesson/182804/homework-requirements)
